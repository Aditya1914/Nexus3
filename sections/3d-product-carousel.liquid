{% comment %}
=================================================================
SHOPIFY 3D PRODUCT CAROUSEL - PROFESSIONAL INTEGRATION
=================================================================
{% endcomment %}

{% comment %} Generate unique ID {% endcomment %}
{% assign carousel_id = section.id | replace: '_', '' | downcase %}

{% comment %} ========== CONFIGURATION VARIABLES ========== {% endcomment %}

{% comment %} SECTION SETTINGS {% endcomment %}
{% assign section_background = section.settings.section_background | default: '#e1d0c8' %}
{% assign main_heading = section.settings.main_heading | default: 'Best Selling Products' %}
{% assign subheading = section.settings.subheading | default: 'Discover our premium electronics collection' %}

{% comment %} CAROUSEL DIMENSIONS - INCREASED FOR BETTER VISIBILITY {% endcomment %}
{% assign carousel_max_width = section.settings.carousel_max_width | default: 380 %}
{% assign carousel_height = section.settings.carousel_height | default: 650 %}
{% assign inner_width = section.settings.inner_width | default: 380 %}
{% assign card_width = section.settings.card_width | default: 380 %}
{% assign card_height = section.settings.card_height | default: 520 %}

{% comment %} COLORS {% endcomment %}
{% assign card_background = section.settings.card_background | default: '#ffffff' %}
{% assign card_text_color = section.settings.card_text_color | default: '#2c3e50' %}
{% assign front_card_bg = section.settings.front_card_bg | default: '#1C9577' %}
{% assign front_card_gradient = section.settings.front_card_gradient | default: '#2ABA96' %}
{% assign front_card_text = section.settings.front_card_text | default: '#ffffff' %}
{% assign button_bg = section.settings.button_bg | default: '#ffffff' %}
{% assign button_text = section.settings.button_text | default: '#000000' %}
{% assign button_border = section.settings.button_border | default: '#c9c9c9' %}
{% assign glow_color = section.settings.glow_color | default: '#8b4513' %}

{% comment %} PRODUCTS {% endcomment %}
{% assign product_1 = section.settings.product_1 %}
{% assign product_2 = section.settings.product_2 %}
{% assign product_3 = section.settings.product_3 %}
{% assign product_4 = section.settings.product_4 %}
{% assign product_5 = section.settings.product_5 %}

<style>
  .bento-section-{{ carousel_id }} {
    background: {{ section_background }};
    background: linear-gradient(135deg, {{ section_background }} 0%, #d4b8a8 100%);
    position: relative;
    overflow: hidden;
    padding: 60px 20px 120px;
    font-family: system-ui, -apple-system, sans-serif;
    font-weight: 300;
  }

  .bento-container-{{ carousel_id }} {
    max-width: 1200px;
    margin: 0 auto;
    text-align: center;
  }

  .bento-header-{{ carousel_id }} {
    margin-bottom: 60px;
    position: relative;
    z-index: 10;
  }

  .bento-title-{{ carousel_id }} {
    font-size: clamp(2rem, 4vw, 3.5rem);
    font-weight: 700;
    color: #2c3e50;
    margin: 0 0 15px 0;
    background: linear-gradient(135deg, #2c3e50 0%, {{ glow_color }} 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .bento-subtitle-{{ carousel_id }} {
    font-size: 1.1rem;
    color: #5a5a5a;
    margin: 0;
    opacity: 0.9;
  }

  .card-carousel-{{ carousel_id }} {
    position: relative;
    margin: 0 auto 0 auto;
    padding: 0;
    max-width: {{ carousel_max_width }}px;
    max-width: 100%;
    height: {{ carousel_height }}px;
    perspective: 2000px;
    perspective-origin: top;
  }

  .button-spin-{{ carousel_id }} {
    position: absolute;
    top: 50%;
    border: 0 none;
    background-color: transparent;
    cursor: pointer;
    font-family: system-ui, sans-serif;
    font-weight: 800;
    padding: 10px 16px;
    color: {{ glow_color }};
    font-size: 18px;
    text-shadow: 1px 1px 4px rgba(0, 54, 90, 0.5);
    transition: all 0.3s ease;
    transform: translateY(-50%);
    z-index: 100;
  }

  .button-spin-{{ carousel_id }}:hover {
    box-shadow: 0px 4px 4px 4px rgba(0, 54, 90, 0.15);
    color: #ffffff;
    text-shadow: 0 0 10px {{ glow_color }};
  }

  .button-spin-{{ carousel_id }}:active {
    box-shadow: none;
  }

  .button-spin-{{ carousel_id }}.counterclockwise {
    left: 0;
  }

  .button-spin-{{ carousel_id }}.clockwise {
    right: 0;
  }

  .inner-carousel-{{ carousel_id }} {
    position: relative;
    width: {{ inner_width }}px;
    margin: 0 auto;
    top: 80px;
    transform-style: preserve-3d;
  }

  .inner-carousel-{{ carousel_id }} > div {
    position: absolute;
    margin: 0 auto;
    padding: 20px;
    width: {{ card_width }}px;
    height: {{ card_height }}px;
    opacity: 1;
    background-color: {{ card_background }};
    color: {{ card_text_color }};
    border-radius: 15px;
    transition: all 0.5s ease-out;
    z-index: 1;
    box-shadow: 0px 15px 25px rgba(0, 54, 90, 0.15);
    overflow: hidden;
  }

  .inner-carousel-{{ carousel_id }} > div:after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 15px;
    opacity: 0.6;
    background-color: #dddddd;
    z-index: 1;
    transition: opacity 0.3s ease;
  }

  .inner-carousel-{{ carousel_id }} > div.counterclockwise:after,
  .inner-carousel-{{ carousel_id }} > div.clockwise:after {
    opacity: 0.4;
    cursor: pointer;
  }

  .inner-carousel-{{ carousel_id }} > div.front:after {
    content: none;
  }

  .inner-carousel-{{ carousel_id }} > div.front {
    background-color: {{ front_card_bg }};
    background-image: radial-gradient(circle 200px at center right, {{ front_card_gradient }}, {{ front_card_bg }});
    color: {{ front_card_text }};
  }

  .product-content-{{ carousel_id }} {
    position: relative;
    z-index: 2;
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  .product-image-{{ carousel_id }} {
    width: 100%;
    height: 240px;
    object-fit: cover;
    border-radius: 12px;
    margin-bottom: 20px;
  }

  .product-image-placeholder-{{ carousel_id }} {
    width: 100%;
    height: 240px;
    background: rgba(0, 0, 0, 0.1);
    border-radius: 12px;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #999999;
  }

  .product-image-placeholder-{{ carousel_id }} svg {
    width: 60px;
    height: 60px;
    opacity: 0.5;
  }

  .product-title-{{ carousel_id }} {
    font-family: system-ui, sans-serif;
    font-weight: 600;
    font-size: 18px;
    margin: 0 0 12px 0;
    line-height: 1.3;
  }

  .product-subtitle-{{ carousel_id }} {
    font-size: 14px;
    opacity: 0.8;
    margin: 0 0 15px 0;
    line-height: 1.4;
  }

  .product-price-{{ carousel_id }} {
    font-size: 22px;
    font-weight: 700;
    margin: auto 0 25px 0;
    color: {{ glow_color }};
  }

  .inner-carousel-{{ carousel_id }} > div.front .product-price-{{ carousel_id }} {
    color: {{ front_card_text }};
  }

  .product-button-{{ carousel_id }} {
    position: absolute;
    text-align: center;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: block;
    width: calc(100% - 40px);
    border: 2px solid {{ button_border }};
    border-radius: 12px;
    padding: 12px 0;
    font-size: 14px;
    font-weight: 600;
    color: {{ button_text }};
    text-decoration: none;
    background-color: {{ button_bg }};
    box-shadow: 0px 8px 15px rgba(0, 54, 90, 0.12);
    transition: all 0.3s ease;
  }

  .inner-carousel-{{ carousel_id }} > div.front .product-button-{{ carousel_id }} {
    box-shadow: 0px 8px 20px rgba(0, 54, 90, 0.18);
  }

  .inner-carousel-{{ carousel_id }} > div.front .product-button-{{ carousel_id }}:hover,
  .inner-carousel-{{ carousel_id }} > div.front .product-button-{{ carousel_id }}:focus {
    border: 2px solid #48CFAD;
    padding: 10px 0;
  }

  .inner-carousel-{{ carousel_id }} > div.front .product-button-{{ carousel_id }}:active {
    box-shadow: none;
  }

  .product-button-{{ carousel_id }}:hover {
    transform: translateX(-50%) translateY(-3px);
    box-shadow: 0px 12px 25px rgba(0, 54, 90, 0.25);
    text-decoration: none;
  }

  .bento-glow-effect-{{ carousel_id }} {
    position: absolute;
    bottom: -100px;
    left: 50%;
    transform: translateX(-50%);
    width: 600px;
    height: 400px;
    background: radial-gradient(ellipse at center, 
      {{ glow_color }}44 0%, 
      {{ glow_color }}22 30%, 
      transparent 70%);
    border-radius: 50%;
    animation: bentoGlow-{{ carousel_id }} 4s ease-in-out infinite alternate;
    pointer-events: none;
    z-index: 1;
  }

  @keyframes bentoGlow-{{ carousel_id }} {
    0% {
      transform: translateX(-50%) scale(0.8);
      opacity: 0.5;
    }
    100% {
      transform: translateX(-50%) scale(1.3);
      opacity: 0.8;
    }
  }

  .bento-light-beam-{{ carousel_id }} {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 4px;
    height: 200px;
    background: linear-gradient(to top, 
      {{ glow_color }} 0%, 
      {{ glow_color }}77 40%, 
      {{ glow_color }}33 80%, 
      transparent 100%);
    animation: bentoBeam-{{ carousel_id }} 3s ease-in-out infinite;
    pointer-events: none;
    z-index: 2;
    border-radius: 2px;
    box-shadow: 0 0 10px {{ glow_color }};
  }

  @keyframes bentoBeam-{{ carousel_id }} {
    0%, 100% {
      opacity: 0.4;
      height: 150px;
    }
    50% {
      opacity: 0.9;
      height: 250px;
      box-shadow: 0 0 20px {{ glow_color }};
    }
  }

  @media screen and (max-width: 768px) {
    .card-carousel-{{ carousel_id }} {
      max-width: 320px;
      height: {{ carousel_height | times: 0.8 }}px;
    }
    
    .inner-carousel-{{ carousel_id }} {
      width: {{ inner_width | times: 0.8 }}px;
    }

    .inner-carousel-{{ carousel_id }} > div {
      width: {{ card_width | times: 0.8 }}px;
      height: {{ card_height | times: 0.8 }}px;
      padding: 15px;
    }
    
    .button-spin-{{ carousel_id }}.counterclockwise {
      left: -10px;
    }
    
    .button-spin-{{ carousel_id }}.clockwise {
      right: -10px;
    }

    .product-image-{{ carousel_id }},
    .product-image-placeholder-{{ carousel_id }} {
      height: 180px;
    }
  }

  @media screen and (max-width: 480px) {
    .button-spin-{{ carousel_id }} {
      display: none;
    }
  }
</style>

<div class="bento-section-{{ carousel_id }}">
  <div class="bento-container-{{ carousel_id }}">
    
    <div class="bento-header-{{ carousel_id }}">
      <h2 class="bento-title-{{ carousel_id }}">{{ main_heading }}</h2>
      <p class="bento-subtitle-{{ carousel_id }}">{{ subheading }}</p>
    </div>

    <div class="card-carousel-{{ carousel_id }}" id="carousel{{ carousel_id }}">
      <button class="button-spin-{{ carousel_id }} counterclockwise">&lt;</button>
      <div class="inner-carousel-{{ carousel_id }}">
        
        {% for i in (1..5) %}
          {% liquid
            case i
              when 1
                assign current_product = product_1
              when 2
                assign current_product = product_2
              when 3
                assign current_product = product_3
              when 4
                assign current_product = product_4
              when 5
                assign current_product = product_5
            endcase
          %}
          
          <div>
            <div class="product-content-{{ carousel_id }}">
              {% if current_product and current_product.featured_media %}
                <img
                  src="{{ current_product.featured_media | image_url: width: 400 }}"
                  alt="{{ current_product.featured_media.alt | default: current_product.title | escape }}"
                  loading="lazy"
                  width="400"
                  height="240"
                  class="product-image-{{ carousel_id }}"
                >
              {% else %}
                <div class="product-image-placeholder-{{ carousel_id }}">
                  {{ 'product-' | append: i | placeholder_svg_tag }}
                </div>
              {% endif %}
              
              {% if current_product %}
                <h4 class="product-title-{{ carousel_id }}">{{ current_product.title }}</h4>
                <div class="product-price-{{ carousel_id }}">{{ current_product.price | money }}</div>
                <a href="{{ current_product.url }}" class="product-button-{{ carousel_id }}">Shop Now</a>
              {% else %}
                <h4 class="product-title-{{ carousel_id }}">Select Product {{ i }}</h4>
                <div class="product-price-{{ carousel_id }}">-</div>
                <a href="#" class="product-button-{{ carousel_id }}">Choose Product</a>
              {% endif %}
            </div>
          </div>
        {% endfor %}

      </div>
      <button class="button-spin-{{ carousel_id }} clockwise">&gt;</button>
      
      <div class="bento-glow-effect-{{ carousel_id }}"></div>
      <div class="bento-light-beam-{{ carousel_id }}"></div>
    </div>
    
  </div>
</div>

<script>
function cardCarousel3d(carousels) {
  var rotateHandler = function(evt) {
    var carousel = this.parentElement;
    if (carousel.classList.contains('card-carousel-{{ carousel_id }}') === false) {
      carousel = carousel.parentElement;
    }
    var rotate_int = parseInt(carousel.dataset.rotateInt || 0);
    if (this.classList.contains('counterclockwise')) {
      rotate_int += 1;
    } else if (this.classList.contains('clockwise')) {
      rotate_int -= 1;
    }
    carousel.dataset.rotateInt = rotate_int;
    animate_slider(carousel);
  };

  for (var i = 0; i < carousels.length; i++) {
    var carousel = carousels[i];
    var inner = carousel.querySelector('.inner-carousel-{{ carousel_id }}');
    var cards = carousel.querySelectorAll('.inner-carousel-{{ carousel_id }} > div');
    var size = cards.length;
    var panelSize = inner.clientWidth;
    var translateZ = Math.round((panelSize / 2) / Math.tan(Math.PI / size)) * 1.7;
    inner.style.transform = 'rotateY(0deg) translateZ(-' + translateZ + 'px)';
    
    var btnLeft = carousel.querySelector('.button-spin-{{ carousel_id }}.counterclockwise');
    if (btnLeft !== null) {
      btnLeft.addEventListener('click', rotateHandler, false);
    }
    var btnRight = carousel.querySelector('.button-spin-{{ carousel_id }}.clockwise');
    if (btnRight !== null) {
      btnRight.addEventListener('click', rotateHandler, false);
    }
    animate_slider(carousel);
  }

  function animate_slider(carousel) {
    var rotate_int = parseInt(carousel.dataset.rotateInt || 0);
    var inner = carousel.querySelector('.inner-carousel-{{ carousel_id }}');
    var cards = carousel.querySelectorAll('.inner-carousel-{{ carousel_id }} > div');
    var size = cards.length;
    var panelSize = inner.clientWidth;
    var translateZ = Math.round((panelSize / 2) / Math.tan(Math.PI / size)) * 1.7;
    var ry = 360 / size;

    for (var i = 0; i < size; i++) {
      var z = (rotate_int * ry) + (i * ry);
      var child = cards[i];
      child.style.transform = 'rotateY(' + z + 'deg) translateZ(' + translateZ + 'px) rotateY(' + (-z) + 'deg)';
      child.classList.remove('clockwise');
      child.classList.remove('front');
      child.classList.remove('counterclockwise');
      child.removeEventListener('click', rotateHandler, false);
      
      var zz = z % 360;
      if (zz === 0) {
        child.classList.add('front');
      } else if (zz === ry || zz === -360 + ry) {
        child.classList.add('clockwise');
        child.addEventListener('click', rotateHandler, false);
      } else if (zz === 360 - ry || zz === 0 - ry) {
        child.classList.add('counterclockwise');
        child.addEventListener('click', rotateHandler, false);
      }
    }
  }
}

cardCarousel3d(document.querySelectorAll('.card-carousel-{{ carousel_id }}'));
</script>

{% schema %}
{
  "name": "3D Product Carousel",
  "settings": [
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "color",
      "id": "section_background",
      "label": "Section Background",
      "default": "#e1d0c8"
    },
    {
      "type": "text",
      "id": "main_heading",
      "label": "Main Heading",
      "default": "Best Selling Products"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Discover our premium electronics collection"
    },
    {
      "type": "header",
      "content": "Carousel Dimensions"
    },
    {
      "type": "range",
      "id": "carousel_max_width",
      "min": 300,
      "max": 500,
      "step": 20,
      "unit": "px",
      "label": "Carousel Max Width",
      "default": 380
    },
    {
      "type": "range",
      "id": "carousel_height",
      "min": 500,
      "max": 800,
      "step": 25,
      "unit": "px",
      "label": "Carousel Height",
      "default": 650
    },
    {
      "type": "range",
      "id": "inner_width",
      "min": 300,
      "max": 500,
      "step": 20,
      "unit": "px",
      "label": "Inner Width",
      "default": 380
    },
    {
      "type": "range",
      "id": "card_width",
      "min": 300,
      "max": 500,
      "step": 20,
      "unit": "px",
      "label": "Card Width",
      "default": 380
    },
    {
      "type": "range",
      "id": "card_height",
      "min": 400,
      "max": 600,
      "step": 20,
      "unit": "px",
      "label": "Card Height",
      "default": 520
    },
    {
      "type": "header",
      "content": "Card Colors"
    },
    {
      "type": "color",
      "id": "card_background",
      "label": "Card Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "card_text_color",
      "label": "Card Text Color",
      "default": "#2c3e50"
    },
    {
      "type": "color",
      "id": "front_card_bg",
      "label": "Front Card Background",
      "default": "#1C9577"
    },
    {
      "type": "color",
      "id": "front_card_gradient",
      "label": "Front Card Gradient",
      "default": "#2ABA96"
    },
    {
      "type": "color",
      "id": "front_card_text",
      "label": "Front Card Text",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_bg",
      "label": "Button Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_text",
      "label": "Button Text",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_border",
      "label": "Button Border",
      "default": "#c9c9c9"
    },
    {
      "type": "color",
      "id": "glow_color",
      "label": "Glow Color",
      "default": "#8b4513"
    },
    {
      "type": "header",
      "content": "Products"
    },
    {
      "type": "product",
      "id": "product_1",
      "label": "Product 1"
    },
    {
      "type": "product",
      "id": "product_2",
      "label": "Product 2"
    },
    {
      "type": "product",
      "id": "product_3",
      "label": "Product 3"
    },
    {
      "type": "product",
      "id": "product_4",
      "label": "Product 4"
    },
    {
      "type": "product",
      "id": "product_5",
      "label": "Product 5"
    }
  ],
  "presets": [
    {
      "name": "3D Product Carousel"
    }
  ]
}
{% endschema %}